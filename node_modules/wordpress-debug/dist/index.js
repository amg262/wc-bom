'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _pify = require('pify');

var _pify2 = _interopRequireDefault(_pify);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (wpConfigPath) {
    var debug = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

    if (!wpConfigPath) {
        throw new Error('Require `wpConfigPath` option');
    }

    return (0, _pify2.default)(_fs2.default).readFile(wpConfigPath).then(function (data) {
        if (!data || data && data.length === 0) {
            throw new Error('Empty contents of `wp-config.php`');
        }

        var positive = null;
        var negative = null;

        if (debug) {
            positive = /(WP_DEBUG|WP_DEBUG_DISPLAY|WP_DEBUG_LOG|SAVEQUERIES|SCRIPT_DEBUG)/i;
            negative = /(CONCATENATE_SCRIPTS|COMPRESS_SCRIPTS|COMPRESS_CSS)/i;
        } else {
            positive = /(CONCATENATE_SCRIPTS|COMPRESS_SCRIPTS|COMPRESS_CSS)/i;
            negative = /(WP_DEBUG|WP_DEBUG_DISPLAY|WP_DEBUG_LOG|SAVEQUERIES|SCRIPT_DEBUG)/i;
        }

        var replaceRegExp = new RegExp('\\((\\\'|")' + '(WP_DEBUG|WP_DEBUG_DISPLAY|WP_DEBUG_LOG|SAVEQUERIES|' + 'SCRIPT_DEBUG|CONCATENATE_SCRIPTS|COMPRESS_SCRIPTS|COMPRESS_CSS)' + '(\\\'|")(.*?),\\s(.*?)\\)', 'gmi');

        return data.toString().replace(replaceRegExp, function (text, unused, foundString) {
            positive.lastIndex = 0;
            negative.lastIndex = 0;

            if (positive.test(foundString)) {
                return '(\'' + foundString + '\', true)';
            } else if (negative.test(foundString)) {
                return '(\'' + foundString + '\', false)';
            }

            return text;
        });
    }).then(function (result) {
        return (0, _pify2.default)(_fs2.default).writeFile(wpConfigPath, result).then(function () {
            return result;
        });
    });
};